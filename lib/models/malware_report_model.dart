import 'package:hive/hive.dart';
part 'malware_report_model.g.dart';

@HiveType(typeId: 2)
class MalwareReportModel extends HiveObject {
  @HiveField(0)
  String id;

  @HiveField(1)
  String malwareType;

  @HiveField(2)
  String infectedDeviceType;

  @HiveField(3)
  String operatingSystem;

  @HiveField(4)
  String detectionMethod;

  @HiveField(5)
  String location;

  @HiveField(6)
  String fileName;

  @HiveField(7)
  String name;

  @HiveField(8)
  String systemAffected;

  @HiveField(9)
  String alertSeverityLevel;

  @HiveField(10)
  DateTime date;

  @HiveField(11)
  bool isSynced;

  @HiveField(12)
  String? keycloackUserId; // Keycloak user ID from JWT token sub field (matching online API)

  // New fields to match backend payload structure
  @HiveField(13)
  String? reportCategoryId;

  @HiveField(14)
  String? reportTypeId;

  @HiveField(15)
  String? alertLevels;

  @HiveField(16)
  String? deviceTypeId;

  @HiveField(17)
  String? detectTypeId;

  @HiveField(18)
  String? operatingSystemName;

  @HiveField(19)
  String? attackName;

  @HiveField(20)
  String? attackSystem;

  @HiveField(21)
  String? createdBy;

  @HiveField(22)
  bool? isActive;

  @HiveField(23)
  DateTime? createdAt;

  @HiveField(24)
  DateTime? updatedAt;

  @HiveField(25)
  int? version;

  // File upload fields
  @HiveField(26)
  List<String>? screenshots; // maps to screenshots (matching online API)

  @HiveField(27)
  List<String>? voiceMessages; // maps to voiceMessages (matching online API)

  @HiveField(28)
  List<String>? documents; // maps to documents (matching online API)

  @HiveField(29)
  List<String>? videofiles; // maps to videofiles (matching online API)

  // Additional fields from payload structure
  @HiveField(30)
  String? description;

  @HiveField(31)
  DateTime? incidentDate;

  @HiveField(32)
  bool? reportOutcome;

  @HiveField(33)
  Map<String, dynamic>? locationCoordinates;

  // Age range fields
  @HiveField(38)
  int? minAge;

  @HiveField(39)
  int? maxAge;

  MalwareReportModel({
    required this.id,
    required this.malwareType,
    required this.infectedDeviceType,
    required this.operatingSystem,
    required this.detectionMethod,
    required this.location,
    required this.fileName,
    required this.name,
    required this.systemAffected,
    required this.alertSeverityLevel,
    required this.date,
    this.isSynced = false,
    this.keycloackUserId,
    this.reportCategoryId,
    this.reportTypeId,
    this.alertLevels,
    this.deviceTypeId,
    this.detectTypeId,
    this.operatingSystemName,
    this.attackName,
    this.attackSystem,
    this.createdBy,
    this.isActive,
    this.createdAt,
    this.updatedAt,
    this.version,
    this.screenshots,
    this.voiceMessages,
    this.documents,
    this.videofiles,
    this.description,
    this.incidentDate,
    this.reportOutcome,
    this.locationCoordinates,
    this.minAge,
    this.maxAge,
  });

  Map<String, dynamic> toJson() => {
    'id': id,
    'malwareType': malwareType,
    'infectedDeviceType': infectedDeviceType,
    'operatingSystem': operatingSystem,
    'detectionMethod': detectionMethod,
    'location': location,
    'fileName': fileName,
    'name': name,
    'systemAffected': systemAffected,
    'alertSeverityLevel': alertSeverityLevel,
    'date': date.toIso8601String(),
    'isSynced': isSynced,
    'keycloackUserId': keycloackUserId,
    'reportCategoryId': reportCategoryId,
    'reportTypeId': reportTypeId,
    'alertLevels': alertLevels,
    'deviceTypeId': deviceTypeId,
    'detectTypeId': detectTypeId,
    'operatingSystemName': operatingSystemName,
    'attackName': attackName,
    'attackSystem': attackSystem,
    'createdBy': createdBy,
    'isActive': isActive,
    'createdAt': createdAt?.toIso8601String(),
    'updatedAt': updatedAt?.toIso8601String(),
    '__v': version,
    'screenshots': screenshots ?? [],
    'voiceMessages': voiceMessages ?? [],
    'documents': documents ?? [],
    'videofiles': videofiles ?? [],
    'description': description,
    'incidentDate': incidentDate?.toIso8601String(),
    'reportOutcome': reportOutcome,
    'locationCoordinates': locationCoordinates,
    'age': {'min': minAge, 'max': maxAge},
  };

  static MalwareReportModel fromJson(Map<String, dynamic> json) =>
      MalwareReportModel(
        id: json['id'] as String,
        malwareType: json['malwareType'] as String,
        infectedDeviceType: json['infectedDeviceType'] as String,
        operatingSystem: json['operatingSystem'] as String,
        detectionMethod: json['detectionMethod'] as String,
        location: json['location'] as String,
        fileName: json['fileName'] as String,
        name: json['name'] as String,
        systemAffected: json['systemAffected'] as String,
        alertSeverityLevel: json['alertSeverityLevel'] as String,
        date: DateTime.parse(json['date'] as String),
        isSynced: json['isSynced'] as bool? ?? false,
        keycloackUserId: json['keycloackUserId'],
        reportCategoryId: json['reportCategoryId'] as String?,
        reportTypeId: json['reportTypeId'] as String?,
        alertLevels: json['alertLevels'] as String?,
        deviceTypeId: json['deviceTypeId'] as String?,
        detectTypeId: json['detectTypeId'] as String?,
        operatingSystemName: json['operatingSystemName'] as String?,
        attackName: json['attackName'] as String?,
        attackSystem: json['attackSystem'] as String?,
        createdBy: json['createdBy'] as String?,
        isActive: json['isActive'] as bool?,
        createdAt: json['createdAt'] != null
            ? DateTime.parse(json['createdAt'] as String)
            : null,
        updatedAt: json['updatedAt'] != null
            ? DateTime.parse(json['updatedAt'] as String)
            : null,
        version: json['__v'] as int?,
        description: json['description'] as String?,
        incidentDate: json['incidentDate'] != null
            ? DateTime.parse(json['incidentDate'] as String)
            : null,
        reportOutcome: json['reportOutcome'] as bool?,
        locationCoordinates:
            json['locationCoordinates'] as Map<String, dynamic>?,
        screenshots: json['screenshots'] != null
            ? List<String>.from(json['screenshots'])
            : null,
        voiceMessages: json['voiceMessages'] != null
            ? List<String>.from(json['voiceMessages'])
            : null,
        documents: json['documents'] != null
            ? List<String>.from(json['documents'])
            : null,
        videofiles: json['videofiles'] != null
            ? List<String>.from(json['videofiles'])
            : null,
        minAge: json['age'] != null ? json['age']['min'] : null,
        maxAge: json['age'] != null ? json['age']['max'] : null,
      );

  MalwareReportModel copyWith({
    String? id,
    String? malwareType,
    String? infectedDeviceType,
    String? operatingSystem,
    String? detectionMethod,
    String? location,
    String? fileName,
    String? name,
    String? systemAffected,
    String? alertSeverityLevel,
    DateTime? date,
    bool? isSynced,
    String? keycloackUserId,
    String? reportCategoryId,
    String? reportTypeId,
    String? alertLevels,
    String? deviceTypeId,
    String? detectTypeId,
    String? operatingSystemName,
    String? attackName,
    String? attackSystem,
    String? createdBy,
    bool? isActive,
    DateTime? createdAt,
    DateTime? updatedAt,
    int? version,
    List<String>? screenshots,
    List<String>? voiceMessages,
    List<String>? documents,
    List<String>? videofiles,
    String? description,
    DateTime? incidentDate,
    bool? reportOutcome,
    Map<String, dynamic>? locationCoordinates,
    int? minAge,
    int? maxAge,
  }) {
    return MalwareReportModel(
      id: id ?? this.id,
      malwareType: malwareType ?? this.malwareType,
      infectedDeviceType: infectedDeviceType ?? this.infectedDeviceType,
      operatingSystem: operatingSystem ?? this.operatingSystem,
      detectionMethod: detectionMethod ?? this.detectionMethod,
      location: location ?? this.location,
      fileName: fileName ?? this.fileName,
      name: name ?? this.name,
      systemAffected: systemAffected ?? this.systemAffected,
      alertSeverityLevel: alertSeverityLevel ?? this.alertSeverityLevel,
      date: date ?? this.date,
      isSynced: isSynced ?? this.isSynced,
      keycloackUserId: keycloackUserId ?? this.keycloackUserId,
      reportCategoryId: reportCategoryId ?? this.reportCategoryId,
      reportTypeId: reportTypeId ?? this.reportTypeId,
      alertLevels: alertLevels ?? this.alertLevels,
      deviceTypeId: deviceTypeId ?? this.deviceTypeId,
      detectTypeId: detectTypeId ?? this.detectTypeId,
      operatingSystemName: operatingSystemName ?? this.operatingSystemName,
      attackName: attackName ?? this.attackName,
      attackSystem: attackSystem ?? this.attackSystem,
      createdBy: createdBy ?? this.createdBy,
      isActive: isActive ?? this.isActive,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
      version: version ?? this.version,
      screenshots: screenshots ?? this.screenshots,
      voiceMessages: voiceMessages ?? this.voiceMessages,
      documents: documents ?? this.documents,
      videofiles: videofiles ?? this.videofiles,
      description: description ?? this.description,
      incidentDate: incidentDate ?? this.incidentDate,
      reportOutcome: reportOutcome ?? this.reportOutcome,
      locationCoordinates: locationCoordinates ?? this.locationCoordinates,
      minAge: minAge ?? this.minAge,
      maxAge: maxAge ?? this.maxAge,
    );
  }
}
